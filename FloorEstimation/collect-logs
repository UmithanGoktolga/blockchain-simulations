#!/bin/bash  
# Short script to extract and store log files

source experimentconfig.sh

LOGSFOLDER="$EXPERIMENTFOLDER/logs/"
DATAFOLDER="$EXPERIMENTFOLDER/results/data/experiment_$1/"
COMMFOLDER=""
REP_FOLDER=$2  # Repetition folder passed from starter.sh


# Create the experiment directory
mkdir -p $LOGSFOLDER $DATAFOLDER $PLOTFOLDER $REP_FOLDER

# Find the latest repetition in that folder
#last_rep=$(ls $DATAFOLDER -v | tail -1 | sed 's/^0*//')
#last_rep=$(ls $DATAFOLDER -v | tail -1)
#new_rep=$(printf "%03d\n" $(($last_rep+1)))
#new_rep=$(printf "%d\n" $(($last_rep+1)))

# Collect experiment configuration into /logs/
python3 collect-config.py
cp experimentconfig.sh $LOGSFOLDER
cp $EXPERIMENTFOLDER/loop_functions/loop_params.py $LOGSFOLDER
cp $EXPERIMENTFOLDER/controllers/control_params.py $LOGSFOLDER

# Collect geth related logs from docker folder into /logs/
for ID in $(seq 1 $NUMROBOTS); do
    cp -rp $DOCKERFOLDER/geth/logs/$ID/ $LOGSFOLDER
done

cp -rp $DOCKERFOLDER/geth/communication_size/ $LOGSFOLDER

# Move data from /logs/ into the repetition folder
cp -rp $LOGSFOLDER/* $REP_FOLDER/

echo "Storing data to: $REP_FOLDER"

